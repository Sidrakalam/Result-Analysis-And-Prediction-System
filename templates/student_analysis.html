<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Performance Analysis</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/student_analysis.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<!-- TOP NAVBAR -->
<nav class="topbar">
    <div class="brand">
        üìä Performance Analysis
        <span class="subtitle">Academic Insights</span>
    </div>

    <div class="info">
        <span class="student">{{ student_name }}</span>
        <span class="semester">{{ student_sem }}</span>
        <a href="/student/dashboard" class="back">‚Üê Dashboard</a>
    </div>
</nav>

<!-- MAIN CONTAINER -->
<div class="container">

    {% if not summary %}
    <!-- NO DATA -->
    <div class="no-data">
        <h2>No Result Data Available</h2>
        <p>Your marks have not been uploaded yet.<br>Please check again later.</p>
    </div>

    {% else %}
    <!-- SUMMARY CARDS -->
    <div class="summary">
        <div class="card blue">
            <h4>Total Subjects</h4>
            <p>{{ summary.total_subjects }}</p>
        </div>
        <div class="card green">
            <h4>Highest Marks</h4>
            <p>{{ summary.highest }}</p>
        </div>
        <div class="card orange">
            <h4>Average</h4>
            <p>{{ summary.average }}</p>
        </div>
    </div>
    {% endif %}

    <!-- CHART -->
    <div class="chart-box">
        <h3>Subject-wise Performance</h3>
        <canvas id="totalChart"></canvas>
    </div>

    <!-- INSIGHTS -->
    <div class="insights">
        <h3>Performance Insights</h3>
        <ul>
            {% for i in insights %}
            <li>{{ i }}</li>
            {% endfor %}
        </ul>
    </div>

</div>

<!-- CHART SCRIPT -->
<script>
    const subjects  = {{ subjects | default([]) | tojson }};
    const totals    = {{ totals   | default([]) | tojson }};

    if (subjects.length > 0) {
        new Chart(document.getElementById("totalChart"), {
            type: "bar",
            data: {
                labels: subjects,
                datasets: [{
                    label: "Total Marks",
                    data: totals,
                    backgroundColor: "#3f51b5",
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }
</script>

</body>
</html>
